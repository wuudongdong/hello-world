# 面试题
## 1. 如何解决缓存和数据库数据不一致的情况？
首先应该明白数据一致性的概念，一致性包含两种情况：一是缓存中有数据，那么缓存的数据应该跟数据库中数据相同；二是缓存中没数据，那么数据库中的数据应该是最新的数据。
- 读写缓存<br>
1、同步写回策略
2、异步写回策略
- 只读缓存<br>
1、先删缓存后删数据库<br>
  延迟双删：更新数据库的线程删除完缓存后，更新数据库的值，暂停一段时间，然后再次删除缓存值。<br>
2、先删数据库后删缓存<br>
  中间件重试机制<br>
- 最佳实践<br>
  多数情况下，会使用只读缓存，并且使用先删除数据库后删除缓存的策略，有两个原因，一是先删缓存会由于缓存缺失给数据库带来压力；二是延迟双删的时间不好测算

参考资料：https://time.geekbang.org/column/article/295812 
## 2. 缓存雪崩、缓存击穿、缓存穿透分别是什么？怎么解决这些问题？
缓存雪崩、缓存击穿、缓存穿透表示的是由于三种不同的原因导致的数据库请求压力激增的现象。
- 缓存雪崩
缓存雪崩的原因有两个，一个是多个key同时失效，二是缓存实例宕机。
- 缓存雪崩的解决方案
应对多个key同时失效，可以采用在key的失效时间上加随机数、服务熔断、降级等方式；应对实例宕机可以采用主从集群的方式
- 缓存击穿
缓存击穿是由于热点key的缺失导致的，解决方案是不设置热点key的超时时间
- 缓存穿透
缓存穿透的原因是缓存和数据库中都没有数据 
- 缓存穿透的解决方案
1、缓存空值或者错误值
2、布隆过滤器
3、前端请求校验，拦截非法请求<br>

参考资料：https://time.geekbang.org/column/article/296586
## 3. 布隆过滤器的原理是什么？
布隆过滤器的三个重要的点是初始值全为0的byte数组、三个哈希函数、取模，布隆过滤器有三个hash函数，对一个值分别进行三次hash运算得到三个不同的值，
再对数组长度取模将该位置置位1，判断值是否在数据库中时，对值进行三次hash运算后取模，如果有为0的，说明值不存在
## 4. 如何用Redis和zk实现分布式锁？
使用Redis来实现分布式锁需要注意三点：一是要使用setnx，就是当值不存在的时候再设置，二是锁要加过期时间，三是锁的值要唯一，避免解锁的时候解错锁，
解锁的时候要保证原子性。实际使用时要考虑重试。<br>
使用zk实现的分布式锁的原理是使用了临时顺序节点的特性，临时节点是客户端连接断开的话会自动删除的节点，加锁的时候创建临时顺序节点，如果创建的临时顺序
节点的顺序最小，表示加锁成功，否则订阅前一个临时顺序节点的删除事件，等待，然后再次尝试加锁，加锁成功后，处理业务，处理完业务之后删除临时节点。<br>

参考资料：https://time.geekbang.org/column/article/301092
https://blog.csdn.net/qq_35190492/article/details/105352672
## 5. 可以谈谈Redis的数据结构以及各种数据结构的实现原理吗？

