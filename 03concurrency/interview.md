# 面试题
## 1. 什么是线程？什么是进程？线程和进程的区别是什么？
线程是程序代码执行的一条线，从java代码层面来说，就是一个方法调用另一个方法，是方法调用链。线程是一个操作系统的概念，它是分配cpu资源和调度执行的基本
单位。
进程是应用程序一次动态执行的过程，操作系统会分配cpu、内存、文件等资源。
一个进程可以包含很多线程，这些线程共享一块内存。对于Linux系统来说，并没有严格区分线程和进程，线程可以看成是轻量级的进程，线程切换开销小，线程占用资
源比进程小，进程之间的内存是独立的。

## 2. 怎么理解线程安全？
线程安全是一个在多线程环境下的正确性的概念，它指的是在多线程对共享的、可改变的状态的正确性。这个状态在java程序中可能是某个数据。

## 3. synchronized 和 ReentrantLock 有什么区别？可重入锁是什么？
synchroized是jdk固有的同步机制，它由一对字节码monitorenter和monitorexit组成，由操作系统的锁实现，其中涉及用户态到内核态的转换，是一个重量级
的锁实现。java6以后，为了提高synchronized的性能，对synchronized进行了优化，出现了偏斜锁、轻量级锁、重量级锁、自旋锁，在这些锁的转换中间，也就
出现了所谓的锁膨胀和锁降级的说法。偏斜锁能在无竞争的情况下提升性能，针对只有一个线程访问同步块。当第一个线程访问同步块儿时，此时
cas更新对象头为当前线程id，偏向锁即使出同步块也不会释放锁，当前线程依然持有锁，偏斜锁只有在cas失败时，也就是真的存在竞争的时候，才会判断持有锁
的线程是否真的还活着，如果还活着，此时持用锁的线程持用的锁升级为轻量级锁，竞争锁的线程自旋cas；如果持用锁的线程不活跃了，那么偏向锁解锁变为无锁重新
偏向。轻量级锁首先把 mark word 和对象的指针拷贝进当前线程的 lock record 中，然后cas更新lock record的指针给对象头，如果成功把锁的标志位置为00，
轻量级锁只有在自旋超过一定次数，或者有自旋更新的情况下，有第三个竞争锁的线程出现，此时升级为重量级锁，重量级锁会阻塞竞争锁的线程，防止自旋CPU空转。

ReentrantLock是java5以后出现的
参考资料：https://wiki.openjdk.java.net/display/HotSpot/Synchronization

## 4. HashMap1.7和1.8扩容有什么区别？ConcurrentHashMap1.7和1.8有什么区别？
HashMap1.7在多线程的情况下存在对象丢失和死链的问题，原因是扩容的过程中存在对next指针的并发修改。java8以后对修复了这个问题，同时当链表长度大于
等于8且数组长度大于等于64时，链表会变为红黑树，当链表长度小于等于6时，红黑树重新变为链表。
ConcurrentHashMap1.7使用的是分段锁，来提高并发性，跟分库分表类似，初始有16个segment锁，每个segment下又是一个map，1.8以后去除了分段锁，使用
cas或者锁单个节点来进一步减少线程冲突。

参考资料：https://cloud.tencent.com/developer/article/1129979

## 5. JDK锁自旋的自旋阈值了解吗？如何调整自旋次数？
默认值是10，可通过+XX：PreBlackPin调整

## 6. CopyOnWriteArrayList的实现原理？主要应用什么场景下？优缺点分别是？
写线程加锁，拷贝一个副本，写线程在副本上操作，最后更新引用值，使用volatile保证读线程立即可见。

## 7. 线程池的状态有哪些？
Running、shutdown、stop、tidying、terminated